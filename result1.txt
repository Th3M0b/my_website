>>> Seed set as: 50
*** Launching P1 ***
-- Process 1 Summary --
  Served regular >>> 206
  Served VIP >>> 61
  Idle total: 1790.00 mins
  Overtime sum: 0.00 mins
  Avg reg wait: 0.00 mins
  Max VIP wait: 0.00 mins
  Evaluation score >>> 1790.00

Simulating Process 2...
-- Process 2 Summary --
  Served regular >>> 204
  Served VIP >>> 57
  Idle total: 1816.00 mins
  Overtime sum: 0.00 mins
  Avg reg wait: 0.04 mins
  Max VIP wait: 0.00 mins
  Evaluation score >>> 1816.12

Comparison:
Process 1 is more effective (score: 1790.00)


#include "VIP_bank.h"
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

void ReadParamsFromFile(const char* filename, int* num_cashiers_regular, int* num_cashiers_vip,
                        double* prob_regular, double* prob_vip,
                        double* avg_service_regular, double* avg_service_vip,
                        int* workday_minutes) {
    FILE* file = fopen(filename, "r");
    if (!file) {
        printf("Error: Could not open file %s\n", filename);
        exit(1);
    }

    char line[128];
    fgets(line, sizeof(line), file); sscanf(line, "%d", workday_minutes);
    fgets(line, sizeof(line), file); sscanf(line, "%d", num_cashiers_regular);
    fgets(line, sizeof(line), file); sscanf(line, "%d", num_cashiers_vip);
    fgets(line, sizeof(line), file); sscanf(line, "%lf", prob_regular);
    fgets(line, sizeof(line), file); sscanf(line, "%lf", prob_vip);
    fgets(line, sizeof(line), file); sscanf(line, "%lf", avg_service_regular);
    fgets(line, sizeof(line), file); sscanf(line, "%lf", avg_service_vip);

    fclose(file);
}

void inferCfgFromExe(char* exePath, char* outCfgPath, size_t maxLen) {
    const char* filename = exePath;
    for (const char* p = exePath; *p; ++p) {
        if (*p == '\\' || *p == '/') {
            filename = p + 1;
        }
    }

    strncpy(outCfgPath, filename, maxLen - 1);
    outCfgPath[maxLen - 1] = '\0';

    char* dot = strrchr(outCfgPath, '.');
    if (dot && strcmp(dot, ".exe") == 0) {
        strcpy(dot, ".cfg");
    } else {
        strcat(outCfgPath, ".cfg");
    }
}

int main(int argc, char* argv[]) {
    int num_cashiers_regular = 0;
    int num_cashiers_vip = 0;
    double prob_regular = 0;
    double prob_vip = 0;
    double avg_service_regular = 0;
    double avg_service_vip = 0;
    int workday_minutes = 0;
    unsigned int seed = (unsigned int)time(NULL);

    int has_params = 0;

    for (int i = 1; i < argc; i++) {
        if (strcmp(argv[i], "-rnd") == 0 && i + 1 < argc) {
            seed = (unsigned int)atoi(argv[++i]);
        } else if (strstr(argv[i], ".txt") || strstr(argv[i], ".cfg")) {
            ReadParamsFromFile(argv[i], &num_cashiers_regular, &num_cashiers_vip,
                               &prob_regular, &prob_vip,
                               &avg_service_regular, &avg_service_vip,
                               &workday_minutes);
            has_params = 1;
        }
    }

    if (!has_params) {
        char cfgName[FILENAME_MAX];
        inferCfgFromExe(argv[0], cfgName, sizeof(cfgName));

        printf("No parameter file provided, trying: %s\n", cfgName);
        ReadParamsFromFile(cfgName, &num_cashiers_regular, &num_cashiers_vip,
                           &prob_regular, &prob_vip,
                           &avg_service_regular, &avg_service_vip,
                           &workday_minutes);
    }

    if (prob_regular < 0 || prob_regular > 100 || prob_vip < 0 || prob_vip > 100) {
        printf("Error: Probabilities must be between 0 and 100.\n");
        exit(1);
    }

    if (num_cashiers_regular <= 0 || num_cashiers_vip <= 0) {
        printf("Error: Number of cashiers must be greater than 0.\n");
        exit(1);
    }

    srand(seed);
    printf(">>> Seed set as: %u\n", seed);

    // Simulation 1 (PROCESS_1)
    printf("*** Launching Process 1 Simulation ***\n");
    SimulationParams params1 = {
        num_cashiers_regular + num_cashiers_vip,
        num_cashiers_regular,
        num_cashiers_vip,
        prob_regular,
        avg_service_regular,
        avg_service_vip
    };

    SimulationResults result1 = runSimulation(PROCESS_1, params1);

    printf("-- Process 1 Summary --\n");
    printf("  Total downtime: %.2f mins\n", result1.total_downtime);
    printf("  Total overtime: %.2f mins\n", result1.total_overtime);
    printf("  Avg normal wait: %.2f mins\n", result1.avg_normal_wait);
    printf("  Max VIP wait: %.2f mins\n", result1.max_vip_wait);

    // Simulation 2 (PROCESS_2)
    printf("\n*** Launching Process 2 Simulation ***\n");
    SimulationParams params2 = {
        num_cashiers_regular + num_cashiers_vip,
        num_cashiers_regular,
        num_cashiers_vip,
        prob_vip,
        avg_service_regular,
        avg_service_vip
    };

    SimulationResults result2 = runSimulation(PROCESS_2, params2);

    printf("-- Process 2 Summary --\n");
    printf("  Total downtime: %.2f mins\n", result2.total_downtime);
    printf("  Total overtime: %.2f mins\n", result2.total_overtime);
    printf("  Avg normal wait: %.2f mins\n", result2.avg_normal_wait);
    printf("  Max VIP wait: %.2f mins\n", result2.max_vip_wait);

    // Comparison
    printf("\nComparison:\n");
    if (result1.total_overtime < result2.total_overtime) {
        printf("Process 1 is more efficient (lower overtime)\n");
    } else {
        printf("Process 2 is more efficient (lower overtime)\n");
    }

    return 0;
}

